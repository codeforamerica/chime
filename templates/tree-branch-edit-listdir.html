{% extends "base.html" %}
{% block title %}Tasks{% endblock %}
{% block content %}
    <h1>Bizarro editor <span><a href="/">tasks</a></span></h1>


    <div class="layout-breve">
        <div class="badge-heading badge-gov badge-teal">
            <h2>Task work</h2>
            <h3>{{branch}}</h3>
        </div>

        <table>
            <thead>
                <tr>
                    <th colspan="3">Changes</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>Status</th>
                    <th>Topic</th> 
                    <th>Options</th>
                </tr>
                {% for (edit_path, view_path) in list_paths %}
                    <form action="." method="POST">
                        <tr>
                            <td><!-- probably something like one of these statuses --><em>Changed / New / Deleted</em></td>
                            <td><a href="{{edit_path}}">{{edit_path}}</a></td>
                            <td>
                                <a href="{{edit_path}}" class="button-alternative">Edit</a>
                                <a href="{{view_path}}" class="button" target="_blank">Preview</a>
                                <input name="action" type="submit" value="Delete" class="button-prominent">
                            </td>
                        </tr>
                        <input name="path" value="{{edit_path}}" type="hidden">
                    </form>
                {% endfor %}  
                <tr>
                    <th colspan="3">
                        <label>Edit existing page 
                          <input type="text" name="pages" list="pages" placeholder="thing/stuff"  />
                          <datalist id="pages">

                          <label> or select one from the list:
                          <select name="pages">
                            {% for (edit_path, view_path) in list_paths %}
                                <option value="{{edit_path}}" />
                            {% endfor %}  
                          </select>
                           </label>

                          </datalist>
                         </label>
                         <a href="{{edit_path}}" class="button-alternative">Edit</a>
                    </th>
                </tr>
                <tr>
                    <th>Create new page</th>
                    <td colspan="2">
                        <form action="." method="POST">
                            <input name="path" placeholder="thing/stuff" type="text" />
                            <input name="action" type="submit" value="Add" />
                        </form>
                    </td>
                </tr>
                <tr>
                    <th>Add a new file</th>
                    <td colspan="2">
                        <form action="." method="POST" enctype="multipart/form-data" />
                            <input name="file" type="file" />
                            <input name="action" type="submit" value="Upload" />
                        </form>
                    </td>
                </tr>
                <tr>
                    <th colspan="3">Actions</th>
                </tr>
                {% if needs_peer_review and not eligible_peer %}
                  <tr><!-- Author options, before sending for review<-->
                    <td colspan="2">
                        <form action="/merge" method="POST">
                            <input name="branch" value="{{branch}}" type="hidden" />
                            <a href="mailto:?to=&amp;subject={{review_subject|urlencode}}&amp;body={{review_body|urlencode}}" class="button button-alternative">Submit for review</a>
                            <button name="action" value="merge" type="submit" class="button-alternative" disabled>Publish (awaiting review)</button>
                        </form>    
                    </td>
                  </tr>

                  <!--tr>[ Author options, after sending for review ]>
                    <td colspan="2">
                        <form action="/merge" method="POST">
                            <input name="branch" value="{{branch}}" type="hidden" />
                            <a class="button-alternative" href="">Retract review</a>
                            <button name="action" value="merge" type="submit" class="button-alternative" disabled>Publish (awaiting review)</button>
                        </form>    
                    </td>
                  </tr>-->
                {% elif is_peer_reviewed and eligible_peer %}
                  <tr><!-- Author options, after getting a good review with no more changes made -->
                    <td colspan="2">
                        <form action="/merge" method="POST">
                            <input name="branch" value="{{branch}}" type="hidden" />
                            <button name="action" value="merge" type="submit" class="button-alternative">Publish</button>
                        </form>    
                    </td>
                  </tr>

                  <!--tr>[ Author options, after getting a bad review ]
                    <td colspan="2">
                        <form action="/merge" method="POST">
                            <input name="branch" value="{{branch}}" type="hidden" />
                            <a class="button-alternative" href="">View suggested changes</a>
                            <a class="button-alternative" href="">Submit for review</a>
                        </form>    
                    </td>
                  </tr-->
                {% elif needs_peer_review and eligible_peer %}
                  <tr><!-- Reviewer options -->
                    <td colspan="2">
                        <form action="/review" method="POST">
                            <input name="branch" value="{{branch}}" type="hidden" />
                            <a class="button-alternative" href="">Suggest changes</a>
                            <button name="action" value="approve" type="submit" class="button-alternative">Reviewed OK</button>
                        </form>    
                    </td>
                  </tr>
                {% else %}
                  <tr><!-- Reviewer options -->
                    <td colspan="2">
                        Needs review? {{ needs_peer_review }}.
                        Is reviewed? {{ is_peer_reviewed }}.
                        Eligible peer? {{ eligible_peer }}.
                    </td>
                  </tr>
                {% endif %}
            </tbody>
        </table>

        <hr><!-- to move into reviewer comment template -->
        <h1>Bizarro editor <span><a href="/">tasks</a></span></h1>
        <div class="layout-breve">
            <div class="badge-heading badge-gov badge-teal">
                <h2>Task review changes</h2>
                <h3>{{branch}}</h3>
            </div>
            <form>
            <ul class="list-form">
                <li class="form-field">
                    <label for="review-changes">Write the changes you think should be made to this task before it's published.</label>
                    <textarea id="review-changes" class="textarea" name="review-changes" type="text"></textarea>
                </li>                      
            </ul>
            <button name="review-feedback" type="submit" />Send feedback</button>  
            </form>
        </div>
    </div>
{% endblock %}
